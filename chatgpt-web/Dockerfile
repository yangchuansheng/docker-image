# build front-end
FROM node:lts-alpine AS builder

RUN apk update && apk add git

RUN git clone https://github.com/Chanzhaoyu/chatgpt-web /app

WORKDIR /app

RUN sed -i '/å¦‚æœä½ è§‰å¾—æ­¤é¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©/a\ \ \ \ \ \ \ \ \ \ <br>ğŸ›’ <a class="text-blue-600" href="https://shop.terobox.com/?from=1069" target="_blank">ChatGPT Plus è®¢é˜…è´¦å·è´­ä¹°</a>' /src/components/common/Setting/About.vue

RUN npm install pnpm -g && pnpm install && pnpm run build

# service
FROM node:lts-alpine

COPY --from=builder /app/service /app
COPY --from=builder /app/dist /app/public

WORKDIR /app
RUN npm install pnpm -g && pnpm install

EXPOSE 3002

CMD ["pnpm", "run", "start"]

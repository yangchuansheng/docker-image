# build front-end
FROM node:lts-alpine AS builder

RUN apk update && apk add git

RUN git clone https://github.com/Chanzhaoyu/chatgpt-web /app

WORKDIR /app

RUN sed -i '/setting.socks/a\ \ \ \ \ \ <p>ğŸ›’ <a class="text-blue-600" href="https://shop.terobox.com/?from=1069" target="_blank">ChatGPT Plus è®¢é˜…è´¦å·è´­ä¹°</a></p>' ./src/components/common/Setting/About.vue; \
    sed -i "s/å¦‚æœä½ è§‰å¾—æ­¤é¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·åœ¨ Github å¸®æˆ‘ç‚¹ä¸ª Star æˆ–è€…ç»™äºˆä¸€ç‚¹èµåŠ©ï¼Œè°¢è°¢ï¼/ç”±äºç»´æŠ¤ç½‘ç«™è¿è¥ï¼Œæœ¬ç½‘ç«™å¯èƒ½å­˜åœ¨æ”¶è´¹æˆ–å¹¿å‘Šç­‰è¡Œä¸ºï¼Œä¸ç¨‹åºä½œè€…æ— å…³ã€‚ /g" ./src/components/common/Setting/About.vue; \
    sed -i '/setting.socks/a\ \ \ \ \ \ <p>ç¾¤ç»„ï¼š <a class="text-blue-600 dark:text-blue-500" href="https://t.me/littleb_tech" target="_blank"> https://t.me/fuck_you_chatgpt </a></p>' ./src/components/common/Setting/About.vue; \
    sed -i 's#https://github.com/Chanzhaoyu/chatgpt-bot#https://t.me/fuck_you_chatgpt#g' ./src/store/modules/user/helper.ts; \
    sed -i 's/Star on/æ¬¢è¿åŠ å…¥/g' ./src/store/modules/user/helper.ts; \
    sed -i 's/GitHub/ç¾¤ç»„/g' ./src/store/modules/user/helper.ts; \
    sed -i 's/GitHub/ç¾¤ç»„/g' ./src/components/custom/GithubSite.vue

RUN npm install pnpm -g && pnpm install && pnpm run build

# service
FROM node:lts-alpine

COPY --from=builder /app/service /app
COPY --from=builder /app/dist /app/public

WORKDIR /app
RUN npm install pnpm -g && pnpm install

EXPOSE 3002

CMD ["pnpm", "run", "start"]
